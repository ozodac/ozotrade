<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OZO Trade - Options Auto Trader</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D2Z8FJ90TR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D2Z8FJ90TR');
  </script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }
    .strategy-card {
      transition: all 0.3s ease;
    }
    .strategy-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const OZOTrade = () => {
      // Strategy mode: 'selection', 'original', 'aggressive', 'dual'
      const [strategyMode, setStrategyMode] = useState('selection');
      
      // Single symbol trading state (for original & aggressive)
      const [balance, setBalance] = useState(100000);
      const [spxPrice, setSpxPrice] = useState(null);
      const [previousPrice, setPreviousPrice] = useState(null);
      const [position, setPosition] = useState(null);
      const [trades, setTrades] = useState([]);
      const [isTrading, setIsTrading] = useState(false);
      const [marketTrend, setMarketTrend] = useState('neutral');
      const [profitLoss, setProfitLoss] = useState(0);
      const [priceHistory, setPriceHistory] = useState([]);
      
      // Dual symbol trading state
      const [spyState, setSpyState] = useState({
        price: null,
        previousPrice: null,
        position: null,
        trades: [],
        balance: 50000,
        profitLoss: 0,
        priceHistory: [],
        marketTrend: 'neutral'
      });
      
      const [spxState, setSpxState] = useState({
        price: null,
        previousPrice: null,
        position: null,
        trades: [],
        balance: 50000,
        profitLoss: 0,
        priceHistory: [],
        marketTrend: 'neutral'
      });
      
      // Shared state
      const [isLiveData, setIsLiveData] = useState(false);
      const [dataError, setDataError] = useState(null);
      const [showApiSettings, setShowApiSettings] = useState(false);
      const [apiKey, setApiKey] = useState('');
      const [apiKeyInput, setApiKeyInput] = useState('');
      const [useTradier, setUseTradier] = useState(false);
      const [optionsChain, setOptionsChain] = useState(null);
      
      // Strategy settings
      const [symbol, setSymbol] = useState('SPY');
      const [riskPercent, setRiskPercent] = useState(2);
      const [profitTarget, setProfitTarget] = useState(50);
      const [stopLoss, setStopLoss] = useState(50);
      const [useTrailingStop, setUseTrailingStop] = useState(false);
      const [trailingStopPercent, setTrailingStopPercent] = useState(20);
      
      // Backtesting
      const [isBacktesting, setIsBacktesting] = useState(false);
      const [backtestResults, setBacktestResults] = useState(null);
      
      // Performance tracking
      const [peakValue, setPeakValue] = useState(null);
      const [maxDrawdown, setMaxDrawdown] = useState(0);
      const [balanceHistory, setBalanceHistory] = useState([100000]);

      // Get strategy thresholds
      const getThresholds = () => {
        if (strategyMode === 'aggressive') {
          return { momentum: 0.001, shortMomentum: 0.0005, volatility: 0.00005 };
        }
        return { momentum: 0.0015, shortMomentum: 0.0008, volatility: 0.0001 };
      };

      const fetchPrice = async (targetSymbol) => {
        try {
          let currentPrice = null;

          if (useTradier && apiKey) {
            const response = await fetch(
              `https://sandbox.tradier.com/v1/markets/quotes?symbols=${targetSymbol}`,
              {
                headers: {
                  'Authorization': `Bearer ${apiKey}`,
                  'Accept': 'application/json'
                }
              }
            );

            if (response.ok) {
              const data = await response.json();
              const quote = data.quotes?.quote;
              if (quote && quote.last) {
                currentPrice = quote.last;
                setIsLiveData(true);
                setDataError(null);
              }
            }
          } else {
            const yahooSymbol = targetSymbol === 'SPY' ? 'SPY' : '%5ESPX';
            const response = await fetch(
              `https://query1.finance.yahoo.com/v8/finance/chart/${yahooSymbol}?interval=1m&range=1d`
            );
            
            if (response.ok) {
              const data = await response.json();
              const quote = data.chart.result[0];
              currentPrice = quote.meta.regularMarketPrice;
              setIsLiveData(true);
              setDataError(null);
            }
          }
          
          if (currentPrice) {
            return currentPrice;
          }
        } catch (error) {
          console.error('Error fetching price:', error);
          setDataError('Using simulation mode');
          setIsLiveData(false);
        }
        
        return null;
      };

      // Update prices based on strategy mode
      useEffect(() => {
        if (strategyMode === 'selection') return;

        const updatePrices = async () => {
          if (strategyMode === 'dual') {
            // Update both SPY and SPX
            const spyPrice = await fetchPrice('SPY');
            const spxPrice = await fetchPrice('SPX');
            
            if (spyPrice) {
              setSpyState(prev => ({
                ...prev,
                previousPrice: prev.price,
                price: spyPrice,
                priceHistory: [...prev.priceHistory.slice(-60), spyPrice]
              }));
            } else if (!spyState.price) {
              setSpyState(prev => ({ ...prev, price: 587 }));
            }
            
            if (spxPrice) {
              setSpxState(prev => ({
                ...prev,
                previousPrice: prev.price,
                price: spxPrice,
                priceHistory: [...prev.priceHistory.slice(-60), spxPrice]
              }));
            } else if (!spxState.price) {
              setSpxState(prev => ({ ...prev, price: 6170 }));
            }
          } else {
            // Single symbol mode
            const price = await fetchPrice(symbol);
            if (price) {
              setPreviousPrice(spxPrice);
              setSpxPrice(price);
              setPriceHistory(prev => [...prev.slice(-60), price]);
            } else if (!spxPrice) {
              setSpxPrice(symbol === 'SPY' ? 587 : 6170);
            }
          }
        };

        updatePrices();
        const interval = setInterval(updatePrices, 5000);
        return () => clearInterval(interval);
      }, [strategyMode, symbol, apiKey, useTradier, spxPrice, spyState.price, spxState.price]);

      // Simulation mode for price movement when not live
      useEffect(() => {
        if (isLiveData || !isTrading || strategyMode === 'selection') return;

        const interval = setInterval(() => {
          if (strategyMode === 'dual') {
            // Simulate both prices
            setSpyState(prev => {
              if (!prev.price) return { ...prev, price: 587 };
              const trendBias = prev.marketTrend === 'bullish' ? 0.52 : prev.marketTrend === 'bearish' ? 0.48 : 0.5;
              const change = (Math.random() - trendBias) * 2;
              const newPrice = Math.max(500, Math.min(650, prev.price + change));
              return {
                ...prev,
                price: newPrice,
                priceHistory: [...prev.priceHistory.slice(-60), newPrice]
              };
            });
            
            setSpxState(prev => {
              if (!prev.price) return { ...prev, price: 6170 };
              const trendBias = prev.marketTrend === 'bullish' ? 0.52 : prev.marketTrend === 'bearish' ? 0.48 : 0.5;
              const change = (Math.random() - trendBias) * 20;
              const newPrice = Math.max(5500, Math.min(6500, prev.price + change));
              return {
                ...prev,
                price: newPrice,
                priceHistory: [...prev.priceHistory.slice(-60), newPrice]
              };
            });
          } else {
            setSpxPrice(prev => {
              if (!prev) return symbol === 'SPY' ? 587 : 6170;
              const trendBias = marketTrend === 'bullish' ? 0.52 : marketTrend === 'bearish' ? 0.48 : 0.5;
              const volatility = symbol === 'SPY' ? 2 : 20;
              const change = (Math.random() - trendBias) * volatility;
              const minPrice = symbol === 'SPY' ? 500 : 5500;
              const maxPrice = symbol === 'SPY' ? 650 : 6500;
              const newPrice = Math.max(minPrice, Math.min(maxPrice, prev + change));
              setPriceHistory(p => [...p.slice(-60), newPrice]);
              return newPrice;
            });
          }
        }, 2000);

        return () => clearInterval(interval);
      }, [isTrading, isLiveData, marketTrend, strategyMode, symbol]);

      const calculateIndicators = (price, history) => {
        if (history.length < 20) return { signal: null, trend: 'neutral', strength: 0 };

        const recent = history.slice(-20);
        const veryRecent = history.slice(-10);
        
        const sma20 = recent.reduce((a, b) => a + b, 0) / recent.length;
        const sma10 = veryRecent.reduce((a, b) => a + b, 0) / veryRecent.length;
        
        const momentum = (price - recent[0]) / recent[0];
        const shortMomentum = (price - veryRecent[0]) / veryRecent[0];
        
        const returns = [];
        for (let i = 1; i < recent.length; i++) {
          returns.push((recent[i] - recent[i-1]) / recent[i-1]);
        }
        const variance = returns.reduce((sum, r) => sum + r * r, 0) / returns.length;
        const volatility = Math.sqrt(variance);

        const trendStrength = Math.abs(momentum) * 100;
        const thresholds = getThresholds();

        let signal = null;
        let trend = 'neutral';

        if (
          price > sma20 && 
          sma10 > sma20 && 
          momentum > thresholds.momentum && 
          shortMomentum > thresholds.shortMomentum &&
          volatility > thresholds.volatility
        ) {
          signal = 'call';
          trend = 'bullish';
        } 
        else if (
          price < sma20 && 
          sma10 < sma20 && 
          momentum < -thresholds.momentum && 
          shortMomentum < -thresholds.shortMomentum &&
          volatility > thresholds.volatility
        ) {
          signal = 'put';
          trend = 'bearish';
        }

        return { signal, trend, strength: trendStrength };
      };

      const findBestContract = (type, price, targetSymbol) => {
        const strikeOffset = targetSymbol === 'SPY' ? 2 : 20;
        return {
          strike: type === 'call' ? Math.round(price + strikeOffset) : Math.round(price - strikeOffset),
          premium: Math.random() * 15 + 5,
          symbol: `${targetSymbol}_${type.toUpperCase()}`
        };
      };

      const calculatePositionValue = (pos, currentPrice) => {
        if (!pos || !currentPrice) return 0;

        const priceMove = currentPrice - pos.entryPrice;
        const isWinning = (pos.type === 'CALL' && priceMove > 0) || 
                          (pos.type === 'PUT' && priceMove < 0);

        if (isWinning) {
          const profitMultiplier = Math.abs(priceMove) / 20;
          return pos.cost * (1 + profitMultiplier * 0.5);
        } else {
          const lossMultiplier = Math.abs(priceMove) / 20;
          return pos.cost * (1 - lossMultiplier * 0.3);
        }
      };

      const executeTradeSignal = (signal, price, currentBalance, targetSymbol) => {
        if (currentBalance < 1000 || !price) return null;

        const contract = findBestContract(signal, price, targetSymbol);
        const contracts = Math.max(1, Math.floor(currentBalance * (riskPercent / 100) / 100));
        const cost = contracts * contract.premium * 100;

        if (cost > currentBalance) return null;

        return {
          type: signal.toUpperCase(),
          strike: contract.strike,
          contracts,
          entryPrice: price,
          premium: contract.premium,
          cost,
          symbol: contract.symbol,
          entryTime: new Date(),
          targetProfit: cost * (profitTarget / 100),
          stopLoss: cost * (stopLoss / 100),
          trailingStopPrice: null,
          highestValue: cost,
          isRealContract: useTradier && apiKey && optionsChain
        };
      };

      const checkExitCondition = (pos, currentPrice) => {
        if (!pos || !currentPrice) return null;

        const currentValue = calculatePositionValue(pos, currentPrice);
        const pnl = currentValue - pos.cost;
        
        let newHighest = pos.highestValue;
        let newTrailing = pos.trailingStopPrice;
        
        if (useTrailingStop && currentValue > pos.highestValue) {
          newHighest = currentValue;
          newTrailing = currentValue * (1 - trailingStopPercent / 100);
        }
        
        const hitProfitTarget = pnl >= pos.targetProfit;
        const hitStopLoss = pnl <= -pos.stopLoss;
        const hitTrailingStop = useTrailingStop && newTrailing && currentValue <= newTrailing;
        const timeExpired = Date.now() - pos.entryTime.getTime() > 300000;
        
        if (hitProfitTarget || hitStopLoss || hitTrailingStop || timeExpired) {
          const exitReason = hitProfitTarget ? 'Profit Target' : 
                            hitTrailingStop ? 'Trailing Stop' :
                            hitStopLoss ? 'Stop Loss' : 'Time Limit';
          
          return {
            exitValue: currentValue,
            pnl,
            exitReason,
            exitPrice: currentPrice
          };
        }

        return { newHighest, newTrailing };
      };

      // Single symbol trading loop
      useEffect(() => {
        if (!isTrading || strategyMode === 'dual' || strategyMode === 'selection' || !spxPrice) return;

        const checkSignal = setInterval(() => {
          const { signal, trend, strength } = calculateIndicators(spxPrice, priceHistory);
          setMarketTrend(trend);
          
          if (!position && signal && strength > 0.05) {
            const newPosition = executeTradeSignal(signal, spxPrice, balance, symbol);
            if (newPosition) {
              setPosition(newPosition);
              setBalance(prev => prev - newPosition.cost);
            }
          }
        }, 10000);

        return () => clearInterval(checkSignal);
      }, [isTrading, position, spxPrice, priceHistory, strategyMode, balance, symbol]);

      useEffect(() => {
        if (!position || !isTrading || strategyMode === 'dual' || strategyMode === 'selection' || !spxPrice) return;

        const monitor = setInterval(() => {
          const result = checkExitCondition(position, spxPrice);
          if (result && result.exitValue) {
            const newTrade = {
              ...position,
              exitPrice: result.exitPrice,
              exitValue: result.exitValue,
              pnl: result.pnl,
              exitReason: result.exitReason,
              exitTime: new Date(),
              outcome: result.pnl > 0 ? 'win' : 'loss'
            };

            setTrades(prev => [newTrade, ...prev].slice(0, 50));
            const newBalance = balance + result.exitValue;
            setBalance(newBalance);
            setProfitLoss(prev => prev + result.pnl);
            setBalanceHistory(prev => [...prev, newBalance].slice(-100));
            
            const currentPeak = Math.max(peakValue || 100000, newBalance);
            setPeakValue(currentPeak);
            const drawdown = ((currentPeak - newBalance) / currentPeak) * 100;
            setMaxDrawdown(Math.max(maxDrawdown, drawdown));
            
            setPosition(null);
          } else if (result && result.newHighest) {
            setPosition(prev => ({
              ...prev,
              highestValue: result.newHighest,
              trailingStopPrice: result.newTrailing
            }));
          }
        }, 3000);

        return () => clearInterval(monitor);
      }, [position, spxPrice, isTrading, strategyMode, balance]);

      // Dual symbol trading loop
      useEffect(() => {
        if (!isTrading || strategyMode !== 'dual') return;

        const checkSignals = setInterval(() => {
          // Check SPY
          if (spyState.price && spyState.priceHistory.length >= 20) {
            const { signal, trend } = calculateIndicators(spyState.price, spyState.priceHistory);
            setSpyState(prev => ({ ...prev, marketTrend: trend }));
            
            if (!spyState.position && signal) {
              const newPosition = executeTradeSignal(signal, spyState.price, spyState.balance, 'SPY');
              if (newPosition) {
                setSpyState(prev => ({
                  ...prev,
                  position: newPosition,
                  balance: prev.balance - newPosition.cost
                }));
              }
            }
          }
          
          // Check SPX
          if (spxState.price && spxState.priceHistory.length >= 20) {
            const { signal, trend } = calculateIndicators(spxState.price, spxState.priceHistory);
            setSpxState(prev => ({ ...prev, marketTrend: trend }));
            
            if (!spxState.position && signal) {
              const newPosition = executeTradeSignal(signal, spxState.price, spxState.balance, 'SPX');
              if (newPosition) {
                setSpxState(prev => ({
                  ...prev,
                  position: newPosition,
                  balance: prev.balance - newPosition.cost
                }));
              }
            }
          }
        }, 10000);

        return () => clearInterval(checkSignals);
      }, [isTrading, strategyMode, spyState, spxState]);

      // Monitor dual positions
      useEffect(() => {
        if (!isTrading || strategyMode !== 'dual') return;

        const monitor = setInterval(() => {
          // Monitor SPY position
          if (spyState.position && spyState.price) {
            const result = checkExitCondition(spyState.position, spyState.price);
            if (result && result.exitValue) {
              const newTrade = {
                ...spyState.position,
                exitPrice: result.exitPrice,
                exitValue: result.exitValue,
                pnl: result.pnl,
                exitReason: result.exitReason,
                exitTime: new Date(),
                outcome: result.pnl > 0 ? 'win' : 'loss'
              };

              setSpyState(prev => ({
                ...prev,
                trades: [newTrade, ...prev.trades].slice(0, 50),
                balance: prev.balance + result.exitValue,
                profitLoss: prev.profitLoss + result.pnl,
                position: null
              }));
            } else if (result && result.newHighest) {
              setSpyState(prev => ({
                ...prev,
                position: {
                  ...prev.position,
                  highestValue: result.newHighest,
                  trailingStopPrice: result.newTrailing
                }
              }));
            }
          }

          // Monitor SPX position
          if (spxState.position && spxState.price) {
            const result = checkExitCondition(spxState.position, spxState.price);
            if (result && result.exitValue) {
              const newTrade = {
                ...spxState.position,
                exitPrice: result.exitPrice,
                exitValue: result.exitValue,
                pnl: result.pnl,
                exitReason: result.exitReason,
                exitTime: new Date(),
                outcome: result.pnl > 0 ? 'win' : 'loss'
              };

              setSpxState(prev => ({
                ...prev,
                trades: [newTrade, ...prev.trades].slice(0, 50),
                balance: prev.balance + result.exitValue,
                profitLoss: prev.profitLoss + result.pnl,
                position: null
              }));
            } else if (result && result.newHighest) {
              setSpxState(prev => ({
                ...prev,
                position: {
                  ...prev.position,
                  highestValue: result.newHighest,
                  trailingStopPrice: result.newTrailing
                }
              }));
            }
          }
        }, 3000);

        return () => clearInterval(monitor);
      }, [isTrading, strategyMode, spyState, spxState]);

      const startStrategy = (mode) => {
        // Track strategy selection in Analytics
        gtag('event', 'strategy_selected', {
          strategy_type: mode
        });
        
        setStrategyMode(mode);
        
        // Reset state based on mode
        if (mode === 'dual') {
          setSpyState({
            price: null,
            previousPrice: null,
            position: null,
            trades: [],
            balance: 50000,
            profitLoss: 0,
            priceHistory: [],
            marketTrend: 'neutral'
          });
          setSpxState({
            price: null,
            previousPrice: null,
            position: null,
            trades: [],
            balance: 50000,
            profitLoss: 0,
            priceHistory: [],
            marketTrend: 'neutral'
          });
        } else {
          setBalance(100000);
          setPosition(null);
          setTrades([]);
          setProfitLoss(0);
          setPriceHistory([]);
          setBalanceHistory([100000]);
          setPeakValue(null);
          setMaxDrawdown(0);
        }
      };

      const toggleTrading = () => {
        setIsTrading(!isTrading);
        gtag('event', 'trading_toggled', {
          action: !isTrading ? 'start' : 'stop',
          strategy: strategyMode
        });
      };

      const resetSimulation = () => {
        if (strategyMode === 'dual') {
          setSpyState(prev => ({
            ...prev,
            position: null,
            trades: [],
            balance: 50000,
            profitLoss: 0,
            priceHistory: []
          }));
          setSpxState(prev => ({
            ...prev,
            position: null,
            trades: [],
            balance: 50000,
            profitLoss: 0,
            priceHistory: []
          }));
        } else {
          setBalance(100000);
          setPosition(null);
          setTrades([]);
          setProfitLoss(0);
          setPriceHistory([]);
          setBalanceHistory([100000]);
          setPeakValue(null);
          setMaxDrawdown(0);
        }
        setIsTrading(false);
        setBacktestResults(null);
      };

      const saveApiKey = () => {
        setApiKey(apiKeyInput);
        setShowApiSettings(false);
        setUseTradier(true);
      };

      const winRate = trades.length > 0 
        ? (trades.filter(t => t.outcome === 'win').length / trades.length * 100).toFixed(1)
        : 0;

      const priceChange = previousPrice && spxPrice ? spxPrice - previousPrice : 0;
      const priceChangePercent = previousPrice ? (priceChange / previousPrice * 100) : 0;

      // Strategy Selection Screen
      if (strategyMode === 'selection') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 p-4 md:p-8">
            <div className="max-w-6xl mx-auto fade-in">
              <div className="text-center mb-16 mt-8">
                <div className="mb-3">
                  <span className="text-6xl md:text-7xl font-bold bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">
                    üî• OZO Trade
                  </span>
                </div>
                <p className="text-lg md:text-xl text-gray-300 font-light tracking-wide">
                  Options Auto Trader
                </p>
                <div className="mt-4 h-px w-32 mx-auto bg-gradient-to-r from-transparent via-orange-500 to-transparent"></div>
              </div>

              <h2 className="text-2xl md:text-3xl text-white text-center mb-12 font-light">
                Select Your Trading Strategy
              </h2>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div 
                  className="strategy-card bg-white/5 backdrop-blur-md rounded-2xl p-8 border border-white/10 cursor-pointer"
                  onClick={() => startStrategy('original')}
                >
                  <div className="text-5xl mb-4">üéØ</div>
                  <h3 className="text-2xl font-bold text-white mb-3">Original</h3>
                  <p className="text-gray-300 mb-4 leading-relaxed">
                    Conservative strategy with 0.15% momentum threshold
                  </p>
                  <div className="space-y-2 text-sm text-gray-400 mb-6">
                    <div>‚Ä¢ Expected: 15-30 trades/month</div>
                    <div>‚Ä¢ Focus: Quality over quantity</div>
                    <div>‚Ä¢ Best for: Real trading</div>
                  </div>
                  <button className="w-full py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all">
                    Launch Original ‚Üí
                  </button>
                </div>

                <div 
                  className="strategy-card bg-white/5 backdrop-blur-md rounded-2xl p-8 border border-white/10 cursor-pointer"
                  onClick={() => startStrategy('aggressive')}
                >
                  <div className="text-5xl mb-4">‚ö°</div>
                  <h3 className="text-2xl font-bold text-white mb-3">Aggressive</h3>
                  <p className="text-gray-300 mb-4 leading-relaxed">
                    Active strategy with 0.10% momentum threshold
                  </p>
                  <div className="space-y-2 text-sm text-gray-400 mb-6">
                    <div>‚Ä¢ Expected: 30-50 trades/month</div>
                    <div>‚Ä¢ Focus: More opportunities</div>
                    <div>‚Ä¢ Best for: Testing & slow markets</div>
                  </div>
                  <button className="w-full py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition-all">
                    Launch Aggressive ‚Üí
                  </button>
                </div>
              </div>

              <div 
                className="strategy-card bg-white/5 backdrop-blur-md rounded-2xl p-8 border border-white/10 cursor-pointer"
                onClick={() => startStrategy('dual')}
              >
                <div className="flex items-start gap-6">
                  <div className="text-6xl">üöÄ</div>
                  <div className="flex-1">
                    <h3 className="text-2xl font-bold text-white mb-3">Dual Symbol</h3>
                    <p className="text-gray-300 mb-4 leading-relaxed">
                      Trade SPY and SPX simultaneously with independent algorithms
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-400 mb-6">
                      <div>‚Ä¢ Split balance: $50k each</div>
                      <div>‚Ä¢ Independent positions</div>
                      <div>‚Ä¢ Double opportunities</div>
                    </div>
                    <button className="py-3 px-8 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white rounded-lg font-semibold transition-all inline-block">
                      Launch Dual Trader ‚Üí
                    </button>
                  </div>
                </div>
              </div>

              <div className="mt-12 text-center">
                <p className="text-gray-400 text-sm">
                  All strategies include: Live data ‚Ä¢ Risk management ‚Ä¢ Tradier integration ‚Ä¢ Google Analytics
                </p>
              </div>
            </div>
          </div>
        );
      }

      // Trading Interface (Single Symbol: Original or Aggressive)
      if (strategyMode === 'original' || strategyMode === 'aggressive') {
        const strategyName = strategyMode === 'original' ? 'Original' : 'Aggressive';
        const thresholds = getThresholds();
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4">
            <div className="max-w-7xl mx-auto">
              {showApiSettings && (
                <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                  <div className="bg-slate-800 rounded-xl p-6 max-w-xl w-full border border-white/20">
                    <h2 className="text-2xl font-bold text-white mb-4">‚öôÔ∏è Settings</h2>
                    
                    <div className="mb-6">
                      <h3 className="text-lg font-semibold text-white mb-3">Symbol Selection</h3>
                      <div className="flex gap-3">
                        <button
                          onClick={() => setSymbol('SPY')}
                          className={`flex-1 px-4 py-3 rounded-lg font-semibold transition-all ${
                            symbol === 'SPY' 
                              ? 'bg-blue-500 text-white' 
                              : 'bg-slate-700 text-gray-300'
                          }`}
                        >
                          SPY
                        </button>
                        <button
                          onClick={() => setSymbol('SPX')}
                          className={`flex-1 px-4 py-3 rounded-lg font-semibold transition-all ${
                            symbol === 'SPX' 
                              ? 'bg-blue-500 text-white' 
                              : 'bg-slate-700 text-gray-300'
                          }`}
                        >
                          SPX
                        </button>
                      </div>
                    </div>

                    <div className="mb-6">
                      <h3 className="text-lg font-semibold text-white mb-3">Tradier API</h3>
                      <input
                        type="password"
                        value={apiKeyInput}
                        onChange={(e) => setApiKeyInput(e.target.value)}
                        placeholder="Enter API Key (optional)"
                        className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg border border-slate-600 focus:border-blue-400 focus:outline-none"
                      />
                    </div>

                    <div className="flex gap-3">
                      <button
                        onClick={saveApiKey}
                        className="flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold"
                      >
                        Save
                      </button>
                      <button
                        onClick={() => setShowApiSettings(false)}
                        className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-semibold"
                      >
                        Cancel
                      </button>
                    </div>
                  </div>
                </div>
              )}

              <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/10">
                <div className="flex items-center justify-between">
                  <div>
                    <h1 className="text-3xl font-bold text-white mb-1">
                      üî• OZO Trade
                    </h1>
                    <p className="text-gray-300 text-sm">
                      {strategyName} Strategy ‚Ä¢ Trading {symbol}
                    </p>
                  </div>
                  <div className="flex items-center gap-3">
                    <button
                      onClick={() => setStrategyMode('selection')}
                      className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm"
                    >
                      ‚Üê Change Strategy
                    </button>
                    <button
                      onClick={() => setShowApiSettings(true)}
                      className="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg"
                    >
                      ‚öôÔ∏è
                    </button>
                    <div className="px-4 py-2 bg-white/5 rounded-lg border border-white/10">
                      <span className={`font-semibold text-sm ${isLiveData ? 'text-green-400' : 'text-orange-400'}`}>
                        {isLiveData ? 'üü¢ LIVE' : 'üü† SIM'}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Balance</div>
                  <div className="text-2xl font-bold text-white">
                    ${balance.toLocaleString(undefined, {minimumFractionDigits: 2})}
                  </div>
                </div>

                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Total P&L</div>
                  <div className={`text-2xl font-bold ${profitLoss >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                    {profitLoss >= 0 ? '+' : ''}${Math.abs(profitLoss).toLocaleString(undefined, {minimumFractionDigits: 2})}
                  </div>
                </div>

                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">{symbol} Price</div>
                  <div className="text-2xl font-bold text-white">
                    {spxPrice ? `$${spxPrice.toFixed(2)}` : 'Loading...'}
                  </div>
                  {priceChange !== 0 && (
                    <div className={`text-xs font-semibold mt-1 ${priceChange > 0 ? 'text-green-400' : 'text-red-400'}`}>
                      {priceChange > 0 ? '+' : ''}{priceChange.toFixed(2)} ({priceChangePercent.toFixed(2)}%)
                    </div>
                  )}
                </div>

                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Win Rate</div>
                  <div className="text-2xl font-bold text-white">{winRate}%</div>
                  <div className="text-xs text-gray-400 mt-1">{trades.length} trades</div>
                </div>
              </div>

              <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <h2 className="text-xl font-bold text-white mb-1">Trading Status</h2>
                    <p className="text-sm text-gray-300">
                      Trend: <span className={`font-semibold ${
                        marketTrend === 'bullish' ? 'text-green-400' : 
                        marketTrend === 'bearish' ? 'text-red-400' : 'text-gray-400'
                      }`}>{marketTrend.toUpperCase()}</span>
                    </p>
                  </div>
                  <div className="flex gap-3">
                    <button
                      onClick={toggleTrading}
                      disabled={!spxPrice}
                      className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                        isTrading 
                          ? 'bg-red-500 hover:bg-red-600 text-white' 
                          : 'bg-green-500 hover:bg-green-600 text-white disabled:opacity-50'
                      }`}
                    >
                      {isTrading ? '‚è∏ Stop' : '‚ñ∂ Start'}
                    </button>
                    <button
                      onClick={resetSimulation}
                      className="px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-semibold"
                    >
                      üîÑ Reset
                    </button>
                  </div>
                </div>

                {position && (
                  <div className="bg-white/5 rounded-lg p-4 border border-white/10">
                    <div className="flex items-center justify-between">
                      <div>
                        <span className={`text-lg font-semibold ${position.type === 'CALL' ? 'text-green-400' : 'text-red-400'}`}>
                          {position.type === 'CALL' ? 'üìà' : 'üìâ'} {position.type} ${position.strike}
                        </span>
                        <div className="text-sm text-gray-400 mt-1">
                          {position.contracts} contracts ‚Ä¢ Entry: ${position.entryPrice.toFixed(2)}
                        </div>
                      </div>
                      <div className="text-right">
                        <div className={`text-xl font-bold ${
                          calculatePositionValue(position, spxPrice) - position.cost > 0 
                            ? 'text-green-400' : 'text-red-400'
                        }`}>
                          ${(calculatePositionValue(position, spxPrice) - position.cost).toFixed(2)}
                        </div>
                        <div className="text-sm text-gray-400">P&L</div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
                <h2 className="text-xl font-bold text-white mb-4">Recent Trades</h2>
                <div className="space-y-2 max-h-96 overflow-y-auto">
                  {trades.length === 0 ? (
                    <p className="text-gray-400 text-center py-8">No trades yet. Start trading to see history.</p>
                  ) : (
                    trades.map((trade, idx) => (
                      <div key={idx} className="bg-white/5 rounded-lg p-4 border border-white/10">
                        <div className="flex items-center justify-between">
                          <div>
                            <span className={`font-semibold ${trade.type === 'CALL' ? 'text-green-400' : 'text-red-400'}`}>
                              {trade.type === 'CALL' ? 'üìà' : 'üìâ'} {trade.type} ${trade.strike}
                            </span>
                            <div className="text-xs text-gray-400 mt-1">
                              {trade.contracts} contracts ‚Ä¢ {trade.exitReason}
                            </div>
                          </div>
                          <div className="text-right">
                            <div className={`text-lg font-bold ${trade.pnl > 0 ? 'text-green-400' : 'text-red-400'}`}>
                              {trade.pnl > 0 ? '+' : ''}${Math.abs(trade.pnl).toFixed(2)}
                            </div>
                            <div className="text-xs text-gray-400">
                              {((trade.pnl / trade.cost) * 100).toFixed(1)}%
                            </div>
                          </div>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>

              <div className="mt-6 bg-yellow-500/10 backdrop-blur-sm rounded-lg p-4 border border-yellow-400/30">
                <p className="text-yellow-200 text-sm">
                  ‚ö†Ô∏è Paper trading with simulated money. Options trading involves substantial risk of loss.
                </p>
              </div>
            </div>
          </div>
        );
      }

      // Dual Symbol Trading Interface
      if (strategyMode === 'dual') {
        const combinedBalance = spyState.balance + spxState.balance;
        const combinedProfitLoss = spyState.profitLoss + spxState.profitLoss;
        const combinedTrades = [...spyState.trades, ...spxState.trades].sort((a, b) => b.exitTime - a.exitTime);
        const winningTrades = combinedTrades.filter(t => t.outcome === 'win').length;
        const combinedWinRate = combinedTrades.length > 0 ? ((winningTrades / combinedTrades.length) * 100).toFixed(1) : 0;

        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
            <div className="max-w-7xl mx-auto">
              <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/10">
                <div className="flex items-center justify-between">
                  <div>
                    <h1 className="text-3xl font-bold text-white mb-1">
                      üî• OZO Trade
                    </h1>
                    <p className="text-gray-300 text-sm">
                      Dual Symbol Strategy ‚Ä¢ SPY + SPX
                    </p>
                  </div>
                  <div className="flex items-center gap-3">
                    <button
                      onClick={() => setStrategyMode('selection')}
                      className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-sm"
                    >
                      ‚Üê Change Strategy
                    </button>
                    <button
                      onClick={() => setShowApiSettings(true)}
                      className="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg"
                    >
                      ‚öôÔ∏è
                    </button>
                    <div className="px-4 py-2 bg-white/5 rounded-lg border border-white/10">
                      <span className={`font-semibold text-sm ${isLiveData ? 'text-green-400' : 'text-orange-400'}`}>
                        {isLiveData ? 'üü¢ LIVE' : 'üü† SIM'}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Combined Balance</div>
                  <div className="text-2xl font-bold text-white">
                    ${combinedBalance.toLocaleString(undefined, {minimumFractionDigits: 2})}
                  </div>
                </div>

                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Combined P&L</div>
                  <div className={`text-2xl font-bold ${combinedProfitLoss >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                    {combinedProfitLoss >= 0 ? '+' : ''}${Math.abs(combinedProfitLoss).toLocaleString(undefined, {minimumFractionDigits: 2})}
                  </div>
                  <div className="text-xs text-gray-400 mt-1">
                    {((combinedProfitLoss / 100000) * 100).toFixed(2)}%
                  </div>
                </div>

                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Total Trades</div>
                  <div className="text-2xl font-bold text-white">{combinedTrades.length}</div>
                  <div className="text-xs text-gray-400 mt-1">
                    SPY: {spyState.trades.length} ‚Ä¢ SPX: {spxState.trades.length}
                  </div>
                </div>

                <div className="bg-white/5 backdrop-blur-sm rounded-lg p-6 border border-white/10">
                  <div className="text-gray-400 text-sm mb-2">Win Rate</div>
                  <div className="text-2xl font-bold text-white">{combinedWinRate}%</div>
                  <div className="text-xs text-gray-400 mt-1">
                    {winningTrades}W / {combinedTrades.length - winningTrades}L
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                {/* SPY Section */}
                <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
                  <div className="mb-4">
                    <div className="flex items-center justify-between mb-2">
                      <h2 className="text-xl font-bold text-white">üìä SPY</h2>
                      <span className={`text-sm font-semibold ${
                        spyState.marketTrend === 'bullish' ? 'text-green-400' : 
                        spyState.marketTrend === 'bearish' ? 'text-red-400' : 'text-gray-400'
                      }`}>
                        {spyState.marketTrend.toUpperCase()}
                      </span>
                    </div>
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <div className="text-gray-400">Balance</div>
                        <div className="text-white font-semibold">${spyState.balance.toLocaleString()}</div>
                      </div>
                      <div>
                        <div className="text-gray-400">Price</div>
                        <div className="text-white font-semibold">${spyState.price ? spyState.price.toFixed(2) : 'Loading...'}</div>
                      </div>
                      <div>
                        <div className="text-gray-400">P&L</div>
                        <div className={`font-semibold ${spyState.profitLoss >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                          {spyState.profitLoss >= 0 ? '+' : ''}${Math.abs(spyState.profitLoss).toFixed(2)}
                        </div>
                      </div>
                      <div>
                        <div className="text-gray-400">Trades</div>
                        <div className="text-white font-semibold">{spyState.trades.length}</div>
                      </div>
                    </div>
                  </div>

                  {spyState.position ? (
                    <div className="bg-white/5 rounded-lg p-3 border border-white/10">
                      <div className="text-sm">
                        <div className={`font-semibold ${spyState.position.type === 'CALL' ? 'text-green-400' : 'text-red-400'}`}>
                          {spyState.position.type === 'CALL' ? 'üìà' : 'üìâ'} {spyState.position.type} ${spyState.position.strike}
                        </div>
                        <div className="text-gray-400 mt-1">
                          P&L: <span className={calculatePositionValue(spyState.position, spyState.price) - spyState.position.cost > 0 ? 'text-green-400' : 'text-red-400'}>
                            ${(calculatePositionValue(spyState.position, spyState.price) - spyState.position.cost).toFixed(2)}
                          </span>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div className="bg-white/5 rounded-lg p-3 border border-white/10 text-center text-gray-400 text-sm">
                      No active position
                    </div>
                  )}
                </div>

                {/* SPX Section */}
                <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
                  <div className="mb-4">
                    <div className="flex items-center justify-between mb-2">
                      <h2 className="text-xl font-bold text-white">üìä SPX</h2>
                      <span className={`text-sm font-semibold ${
                        spxState.marketTrend === 'bullish' ? 'text-green-400' : 
                        spxState.marketTrend === 'bearish' ? 'text-red-400' : 'text-gray-400'
                      }`}>
                        {spxState.marketTrend.toUpperCase()}
                      </span>
                    </div>
                    <div className="grid grid-cols-2 gap-4 text-sm">
                      <div>
                        <div className="text-gray-400">Balance</div>
                        <div className="text-white font-semibold">${spxState.balance.toLocaleString()}</div>
                      </div>
                      <div>
                        <div className="text-gray-400">Price</div>
                        <div className="text-white font-semibold">${spxState.price ? spxState.price.toFixed(2) : 'Loading...'}</div>
                      </div>
                      <div>
                        <div className="text-gray-400">P&L</div>
                        <div className={`font-semibold ${spxState.profitLoss >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                          {spxState.profitLoss >= 0 ? '+' : ''}${Math.abs(spxState.profitLoss).toFixed(2)}
                        </div>
                      </div>
                      <div>
                        <div className="text-gray-400">Trades</div>
                        <div className="text-white font-semibold">{spxState.trades.length}</div>
                      </div>
                    </div>
                  </div>

                  {spxState.position ? (
                    <div className="bg-white/5 rounded-lg p-3 border border-white/10">
                      <div className="text-sm">
                        <div className={`font-semibold ${spxState.position.type === 'CALL' ? 'text-green-400' : 'text-red-400'}`}>
                          {spxState.position.type === 'CALL' ? 'üìà' : 'üìâ'} {spxState.position.type} ${spxState.position.strike}
                        </div>
                        <div className="text-gray-400 mt-1">
                          P&L: <span className={calculatePositionValue(spxState.position, spxState.price) - spxState.position.cost > 0 ? 'text-green-400' : 'text-red-400'}>
                            ${(calculatePositionValue(spxState.position, spxState.price) - spxState.position.cost).toFixed(2)}
                          </span>
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div className="bg-white/5 rounded-lg p-3 border border-white/10 text-center text-gray-400 text-sm">
                      No active position
                    </div>
                  )}
                </div>
              </div>

              <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 mb-6 border border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <h2 className="text-xl font-bold text-white">Controls</h2>
                  <div className="flex gap-3">
                    <button
                      onClick={toggleTrading}
                      className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                        isTrading 
                          ? 'bg-red-500 hover:bg-red-600 text-white' 
                          : 'bg-green-500 hover:bg-green-600 text-white'
                      }`}
                    >
                      {isTrading ? '‚è∏ Stop Both' : '‚ñ∂ Start Trading'}
                    </button>
                    <button
                      onClick={resetSimulation}
                      className="px-6 py-3 bg-slate-600 hover:bg-slate-700 text-white rounded-lg font-semibold"
                    >
                      üîÑ Reset
                    </button>
                  </div>
                </div>
              </div>

              <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
                <h2 className="text-xl font-bold text-white mb-4">Combined Trade History</h2>
                <div className="space-y-2 max-h-96 overflow-y-auto">
                  {combinedTrades.length === 0 ? (
                    <p className="text-gray-400 text-center py-8">No trades yet. Start trading to see history.</p>
                  ) : (
                    combinedTrades.slice(0, 20).map((trade, idx) => (
                      <div key={idx} className="bg-white/5 rounded-lg p-4 border border-white/10">
                        <div className="flex items-center justify-between">
                          <div>
                            <span className={`font-semibold ${trade.type === 'CALL' ? 'text-green-400' : 'text-red-400'}`}>
                              {trade.type === 'CALL' ? 'üìà' : 'üìâ'} {trade.symbol.split('_')[0]} {trade.type} ${trade.strike}
                            </span>
                            <div className="text-xs text-gray-400 mt-1">
                              {trade.contracts} contracts ‚Ä¢ {trade.exitReason}
                            </div>
                          </div>
                          <div className="text-right">
                            <div className={`text-lg font-bold ${trade.pnl > 0 ? 'text-green-400' : 'text-red-400'}`}>
                              {trade.pnl > 0 ? '+' : ''}${Math.abs(trade.pnl).toFixed(2)}
                            </div>
                            <div className="text-xs text-gray-400">
                              {((trade.pnl / trade.cost) * 100).toFixed(1)}%
                            </div>
                          </div>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>

              <div className="mt-6 bg-yellow-500/10 backdrop-blur-sm rounded-lg p-4 border border-yellow-400/30">
                <p className="text-yellow-200 text-sm">
                  ‚ö†Ô∏è Paper trading with simulated money. Options trading involves substantial risk of loss.
                </p>
              </div>
            </div>
          </div>
        );
      }

      return null;
    };

    ReactDOM.render(<OZOTrade />, document.getElementById('root'));
  </script>
</body>
</html>